
@{
    var user = Session["username"];
    if (Session["username"] == null || Session["user_id"] == null)
    {
        Response.Redirect("~/Login/Index");
    }
    if (Session["role_id"].ToString() == "1")
    {
        Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    }
    if (Session["role_id"].ToString() == "2")
    {
        Layout = "~/Views/Shared/_LayoutLecturer.cshtml";
    }
    if (Session["role_id"].ToString() == "3")
    {
        Layout = "~/Views/Shared/_LayoutStudent.cshtml";
    }
}
<!-- Page Content -->
<div class="container" id="admin-container">
    <div class="row">
        <div class="col-lg-3">
            <h3 class="my-4">Danh mục</h3>
            <ul class="mainmenu">
                <li class="mainmenu-item">
                    @* cái mainmenu-item này bao cái thẻ đó bên trong  *@
                    <a class="mainmenu-item-text">Ebooks</a>
                    <ul class="submenu" id="loadSubjectOfEbook">
                        @*load các môn học trong ebook*@
                    </ul>
                </li>
                @* *@
                <li class="mainmenu-item">
                    <a class="mainmenu-item-text" href="">Tiểu luận</a>
                    <ul class="submenu" id="loadSubjectOfEssay">
                        @*load các môn  trong essays*@
                    </ul>
                </li>
                <li class="mainmenu-item">
                    <a class="mainmenu-item-text" href="">Khóa luận</a>
                    <ul class="submenu" id="loadSubjectOfThesis">
                        @*load các môn  trong Thesis*@
                    </ul>
                </li>
            </ul>
            <!-- Upload EBOOK -->
            <div class="modal" id="myModal">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Thêm</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <!-- Form Upload Ebook -->
                        <div class="modal-body">
                            <form id="formEbook" method="post" enctype="multipart/form-data">
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Tiêu đề:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="title" placeholder="Tiêu đề" name="title"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3">  <label for="text">Tác giả:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="author" placeholder="Tác giả" name="author"></div>
                                    </div>
                                </div>
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"><label for="text">Năm xuất bản:</label></div>
                                        <div class="col-md-9"><input type="number" class="form-control" id="year" placeholder="Năm xuất bản" name="year"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"><label for="text">Bộ môn:</label></div>
                                        <div class="col-md-9"><select id="subject" class="form-control"></select></div>
                                    </div>
                                </div>
                                <div class="form-group mar_bottom">
                                    <label for="text">Browser</label>

                                    <input type="file" name="Files" multiple id="fileInput" />
                                </div>
                                <div class="form-group">
                                    <label for="text">Mô tả:</label>
                                    <textarea type="text" class="form-control" id="describe" placeholder="Mô tả" name="describe" style="height: 150px;"></textarea>
                                </div>

                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button id="Save" type="button" class="btn btn-primary" style="width: 70px;">Lưu</button>
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Đóng</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Upload TIỂU LUẬN -->
            <div class="modal" id="modalEssay">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Thêm</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <!-- Form Upload Ebook -->
                        <div class="modal-body">
                            <form id="formEssay" method="post" enctype="multipart/form-data">
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Tiêu đề:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="titleE" placeholder="Tiêu đề" name="titleE"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">GVHD:</label></div>
                                        <div class="col-md-9">  <input type="text" class="form-control" id="instructorE" placeholder="GVHD" name="instructorE"></div>
                                    </div>
                                </div>
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text" style="width: 86px;">Sinh viên  1:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="student1E" placeholder="Sinh viên 1" name="student1E"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text" style="width: 86px;">Sinh viên 2:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="student2E" placeholder="Sinh viên 2" name="student2E"></div>
                                    </div>
                                </div>
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Khóa:</label></div>
                                        <div class="col-md-9"><input type="text" class="form-control" id="courseE" placeholder="Khóa" name="courseE"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Bộ môn:</label></div>
                                        <div class="col-md-9"> <select id="SubjectEssay" class="form-control"></select></div>
                                    </div>
                                </div>
                                <div class="form-group mar_bottom">
                                    <label for="text">Browser</label>
                                    <input type="file" name="Files" multiple id="fileInputE" />
                                </div>
                                <div class="form-group">
                                    <label for="text">Mô tả:</label>
                                    <textarea type="text" class="form-control" id="describeE" placeholder="Mô tả" name="describeE" style="height: 150px;"></textarea>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button id="SaveEssay" type="button" class="btn btn-primary" style="width: 70px;">Lưu</button>
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Đóng</button>
                                </div>
                                @*<div style="margin-top:20px">
                                <button id="uploadEssay" type="submit" class="btn btn-primary">Upload</button>
                            </div>*@
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Upload khóa luận-->
            <div class="modal" id="modalThesis">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Thêm</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <!-- Form Upload Ebook -->
                        <div class="modal-body">
                            <form id="formThesis" method="post" enctype="multipart/form-data">
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Tiêu đề:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="titleT" placeholder="Tiêu đề" name="titleT"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">GVHD:</label></div>
                                        <div class="col-md-9">  <input type="text" class="form-control" id="instructorT" placeholder="GVHD" name="instructorT"></div>
                                    </div>
                                </div>
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text" style="width: 86px;">Sinh viên  1:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="student1T" placeholder="Sinh viên 1" name="student1T"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text" style="width: 86px;">Sinh viên 2:</label></div>
                                        <div class="col-md-9"> <input type="text" class="form-control" id="student2T" placeholder="Sinh viên 2" name="student2T"></div>
                                    </div>
                                </div>
                                <div class="form-row mar_bottom">
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Khóa:</label></div>
                                        <div class="col-md-9"><input type="text" class="form-control" id="courseT" placeholder="Khóa" name="courseT"></div>
                                    </div>
                                    <div class="row col-md-6">
                                        <div class="col-md-3"> <label for="text">Bộ môn:</label></div>
                                        <div class="col-md-9"> <select id="SubjectThesis" class="form-control"></select></div>
                                    </div>
                                </div>
                                <div class="form-group mar_bottom">
                                    <label for="text">Browser</label>
                                    <input type="file" name="Files" multiple id="fileInputT" />
                                </div>
                                <div class="form-group">
                                    <label for="text">Mô tả:</label>
                                    <textarea type="text" class="form-control" id="describeT" placeholder="Mô tả" name="describeT" style="height: 150px;"></textarea>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button id="SaveThesis" type="button" class="btn btn-primary" style="width: 70px;">Lưu</button>
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Đóng</button>
                                </div>
                                @*<div style="margin-top:20px">
                                <button id="uploadEssay" type="submit" class="btn btn-primary">Upload</button>
                            </div>*@
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- /.col-lg-3 -->
        <div class="col-lg-9">
            <!--carousel-->
            <div id="carouselExampleIndicators" class="carousel slide my-4" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner" role="listbox">
                    <div class="carousel-item active">
                        <img class="d-block img-fluid" src="~/Content/img/banner.png" alt="First slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block img-fluid" src="~/Content/img/banner1.png" alt="Second slide">
                    </div>

                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            <!-- tạo các tab liên quan -->
            @*<div id="navigation">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a id="breadcrumb-1" href="">Admin</a></li>
                    <li class="breadcrumb-item breadcrumb-item-2" style="display:none;"><a id="breadcrumb-2" href="#"></a></li>
                    <li class="breadcrumb-item breadcrumb-item-3 active" style="display:none;" id="breadcrumb-3"></li>

                </ul>
            </div>*@
            <!-- navigation -->
            <section id="admin-content-section" hidden="hidden">
                <div class="d-flex justify-content-between mb-3">
                    <h1 id="ebook" class="khoangcachduoi">Ebooks</h1>
                    <div>
                        <button id="btn_upload" type="button" class="btn_login btn btn-success" data-toggle="modal" data-target="#myModal" style="margin-top:10px;">Thêm</button>
                        
                    </div>

                </div>
                <div class="row" id="loadEbook" data-bind="foreach: resultArr">
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <h1 id="essay" class="khoangcachduoi">Tiểu luận</h1>
                    <div>
                        <button id="btn_upload1" type="button" class="btn_login btn btn-success" data-toggle="modal" data-target="#modalEssay" style="margin-top:10px;">Thêm</button>
                    </div>
                </div>
                <div class="row" id="loadEssay" data-bind="foreach: resultArr">

                </div>
                <div class="d-flex justify-content-between mb-3">
                    <h1 id="thesis" class="khoangcachduoi">Khóa luận</h1>
                    <div>
                        <button id="btn_upload2" type="button" class="btn_login btn btn-success" data-toggle="modal" data-target="#modalThesis" style="margin-top:10px;">Thêm</button>
                    </div>
                </div>
                <div class="row" id="loadThesis" data-bind="foreach: resultArr">
                </div>
                @*// phân trang*@
                <div class="col-lg-12 col-md-6 mb-4">
                    <div id="pagination-container" class="pagination justify-content-center"></div>
                </div>
            </section>
        </div>
    </div>
 </div>
  

<!--EBOOK-->
<script>
    //lấy môn học của ebook
    $(document).ready(function () {
        var warnOptions = {
            autoHideDelay: 1000,
            showAnimation: "fadeIn",
            hideAnimation: "fadeOut",
            hideDuration: 700,
            arrowShow: false,
            className: "warn",
        };
        var successOptions = {
            autoHideDelay: 1000,
            showAnimation: "fadeIn",
            hideAnimation: "fadeOut",
            hideDuration: 700,
            arrowShow: false,
            className: "success",
        };
        var errorOptions = {
            autoHideDelay: 1000,
            showAnimation: "fadeIn",
            hideAnimation: "fadeOut",
            hideDuration: 700,
            arrowShow: false,
            className: "error",
        };
        //Ẩn hiện form
        $("#btn_upload").hide();
        $("#btn_upload1").hide();
        $("#btn_upload2").hide();
        // hàm trả về html thông tin file ebooks
        function simpleTemplating(result) {
            var data = "";
            $.each(result, function (i, v) {
                data += "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                data += "<div class='card h-100'>";
                data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                data += "<div class='card-body'>";
                data += "<h4 class='card-title'>";//
                data += "<a href='/Details/Details?ebook_id=" + v.ebook_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                data += "<h5>tác giả: " + v.author + "</h5>";
                data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                data += " </div></div></div></div>";
            });
            return data;
        }
        //load môn học ebooks
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetSubjectEbook",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                $.each(result, function (i, v) {
                    //load các môn của ebook lên thanh danh mục bên trái
                    $("#loadSubjectOfEbook").append("<li id='ebook_" + v.id + "'><a>" + v.name +"</a></li >");
                    //click môn học load file
                    $("#ebook_" + v.id).click(function (e) {
                        //Ẩn hiện form upload file ở trang chỉ hay uplaod file trong môn học
                        $("#btn_upload").show();
                        $("#btn_upload1").hide();
                        $("#btn_upload2").hide();
                        $("#ebook").show();
                        $("#essay").hide();
                        $("#thesis").hide();
                        $("#loadEbook").show();
                        $("#loadEssay").hide();
                        $("#loadThesis").hide();

                        $("#subject").empty();
                        $("#subject").append("<option value='" + v.id + "'>" + v.name + "</option>");
                        $("#loadEbook").empty();
                        $.ajax({
                            type: "GET",
                            url: "/api/AdminAPI/GetEbook?id=" + v.id,
                            //data: { id: v.id },
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {
                                console.log(result);
                                var tag = $(e.currentTarget).closest('.mainmenu-item');

                                var tagText = $(tag).find('.mainmenu-item-text');
                                $('.breadcrumb-item-2').css("d isplay", "block");
                                $('.breadcrumb-item-3').css("display", "block");
                                $('#breadcrumb-2').text($(tagText).text());
                                $('#breadcrumb-3').text(v.name);
                                $.each(result, function (i, v) {
                                    console.log("ebookid",v.ebook_id);
                                    var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                                    data += "<div class='card h-100'>";
                                    data += "<a href='#'><img class='card-img-top' src='~/Content/img/pdf.png' alt=''></a>";
                                    data += "<div class='card-body'>";
                                    data += "<h4 class='card-title'>";//
                                    data += "<a href='/Details/Details?ebook_id=" + v.ebook_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                                    data += "<h5>tác giả: " + v.author + "</h5>";
                                    data += "<p class='card-text' data-bind='text:author'></p>";
                                    data += "<div class='card-footer'></div>";
                                    data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                                    data += " </div></div></div>";

                                    $("#loadEbook").append(data);
                                });
                                $('#pagination-container').pagination({
                                    dataSource: function (done) {

                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/AdminAPI/GetEbookPaging',
                                            data: { id: v.id },
                                            contentType: "application/json; charset=utf-8",
                                            dataType: "json",
                                            success: function (response) {
                                                done(response);
                                            }
                                        });
                                    },
                                    pageSize: 9,
                                    callback: function (data, pagination) {
                                        var html = simpleTemplating(data);
                                        $('#loadEbook').html(html);
                                    }
                                })
                            }
                        });
                    });
                });
            }
        });
        //Thêm
        $("#Save").click(function () {
            function ResetFormEbook() {
                $("#title").val("");
                $("#author").val("");
                $("#year").val("");
                $("#describe").val("");
                $("#fileInput").val("");
            }
            debugger;
            var title = $("#title").val();
            var author = $("#author").val();
            var data = new FormData();
            var files = $("#fileInput").get(0).files;
            var data = new FormData();
            for (var i = 0; i < files.length; i++) {
                data.append("fileInput", files[i]);
            }
            data.append("title", title);
            data.append("describe", $("#describe").val());
            data.append("author", author);
            data.append("year", $("#year").val());
            data.append("userid",@Session["user_id"]);
            data.append("subid", $("#subject option:selected").val());
            console.log(data);
            if (title == null || title == "") {
                $("#title").focus();
                $.notify("Bạn phải nhập tiêu đề!", warnOptions);
                return;
            }
            if (author == null || author == "") {
                $("#author").focus();
                $.notify("Bạn phải nhập tác giả!", warnOptions);
                return;
            }
            if (files.length <= 0) {
                $.notify("Bạn phải chọn file!", warnOptions);
                return;
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/api/AdminAPI/UploadFiles",
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    data: data,
                    success: function (result) {
                        if (result.isSuccess) {
                            ResetFormEbook();
                            $.notify("Thêm thành công!", successOptions);
                            console.log("aaa", result);
                            var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                            data += "<div class='card h-100'>";
                            data += "<a href='#'><img class='card-img-top' src='~/Content/img/pdf.png' alt=''></a>";
                            data += "<div class='card-body'>";
                            data += "<h4 class='card-title'>";//
                            data += "<a href='/Details/Details?ebook_id=" + result.ebook_id + "'" + "data-bind='text:title'>" + result.title + "</a> </h4>";
                            data += "<h5>tác giả: " + result.author + "</h5>";
                            data += "<p class='card-text' data-bind='text:author'></p>";
                            data += "<div class='card-footer'></div>";
                            data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                            data += " </div></div></div>";

                            $("#loadEbook").append(data);
                          
                        } else {
                            if (result.message != null) {
                                $.notify(result.message, errorOptions);
                            }
                            else {
                                $.notify("Thêm thất bại!", errorOptions);
                            }
                        }
                    }
                });
            }

        });


        //Tiểu luận
        function simpleTemplating1(result) {
            var data = "";
            $.each(result, function (i, v) {
                data += "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                data += "<div class='card h-100'>";
                data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                data += "<div class='card-body'>";
                data += "<h4 class='card-title'>";//
                data += "<a href='/Details/DetailsEssay?essay_id=" + v.essay_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                data += "<h5>GVHD: " + v.instructor + "</h5>";
                data += "<p class='card-text' data-bind='text:author'></p>";
                data += "<div class='card-footer'></div>";
                data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                data += " </div></div></div>";
            });
            return data;
        }
        // load môn tiểu luận
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetSubjectEssay",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                $.each(result, function (i, v) {
                    //load các môn của ebook lên thanh danh mục bên trái
                    $("#loadSubjectOfEssay").append("<li id='essay_" + v.id + "'><a>" + v.name + "</a></li >");
                    //click môn học load file
                    $("#essay_" + v.id).click(function (e) {
                        //Ẩn hiện form upload file ở trang chỉ hay uplaod file trong môn học
                        $("#btn_upload1").show();
                        $("#btn_upload2").hide();
                        $("#btn_upload").hide();
                        $("#essay").show();
                        $("#thesis").hide();
                        $("#loadThesis").hide();
                        $("#ebook").hide();
                        $("#loadEbook").hide();
                        $("#loadEssay").show();
                        $("#loadThesis").empty();
                        $("#loadEbook").empty();
                        $("#loadEssay").empty();

                        $("#SubjectEssay").empty();
                        $("#SubjectEssay").append("<option value='" + v.id + "'>" + v.name + "</option>");
                        
                        $.ajax({
                            type: "GET",
                            url: "/api/AdminAPI/GetEssay",
                            data: { id: v.id },
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {
                                console.log(v);

                                var tag = $(e.currentTarget).closest('.mainmenu-item');

                                var tagText = $(tag).find('.mainmenu-item-text');
                                $('.breadcrumb-item-2').css("display", "block");
                                $('.breadcrumb-item-3').css("display", "block");
                                $('#breadcrumb-2').text($(tagText).text());
                                $('#breadcrumb-3').text(v.name);

                                //$("#loadEbook").append(data);
                                //});
                                $('#pagination-container').pagination({
                                    dataSource: function (done) {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/AdminAPI/GetEssayPaging',
                                            data: { id: v.id },
                                            contentType: "application/json; charset=utf-8",
                                            dataType: "json",
                                            success: function (response) {
                                                done(response);
                                            }
                                        });
                                    },
                                    callback: function (data, pagination) {
                                        var html = simpleTemplating1(data);
                                        $('#loadEssay').html(html);
                                    }
                                })
                            }
                        });
                    });
                });
            }
        });
         $('body').on('click', '#SaveEssay', function () {
            var title = $("#titleE").val();
            var instructor = $("#instructorE").val();
            var student1 = $("#student1E").val();
            var course = $("#courseE").val();
            var files = $("#fileInputE").get(0).files;
            var data = new FormData();

              for (var i = 0; i < files.length; i++) {
                  data.append("fileInput", files[i]);
            }
              //cái này là lấy thông tin trên text box  title là key tiltle.val() là giá trị
            data.append("title", $("#titleE").val());
            data.append("describe", $("#describeE").val());
            data.append("instructor", $("#instructorE").val());
            data.append("student1", $("#student1E").val());
            data.append("student2", $("#student2E").val());
            data.append("userid",@Session["user_id"]);
            data.append("subid", $("#SubjectEssay option:selected").val());
            data.append("course", $("#courseE").val());
            if (title == null || title == "") {
                $("#titleE").focus();
                $.notify("Bạn phải nhập tiêu đề!", warnOptions);
                return;
            }
            if (instructor == null || instructor == "") {
                $("#instructorE").focus();
                $.notify("Bạn phải nhập giáo viên hướng dẫn!", warnOptions);
                return;
            }
            if (student1 == null || student1 == "") {
                $("#student1E").focus();
                $.notify("Bạn phải nhập sinh viên 1!", warnOptions);
                return;
            }
            if (course == null || course == "") {
                $("#courseE").focus();
                $.notify("Bạn phải nhập khóa học!", warnOptions);
                return;
            }
            if (files.length <= 0) {
                $.notify("Bạn phải chọn file!", warnOptions);
                return;
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/api/AdminAPI/UploadFileEssay",
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    data: data,
                    success: function (result) {
                        if (result.isSuccess) {
                            $.notify("Thêm thành công!", successOptions);
                            var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                            data += "<div class='card h-100'>";
                            data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                            data += "<div class='card-body'>";
                            data += "<h4 class='card-title'>";//
                            data += "<a href='/Details/DetailsEssay?essay_id=" + v.essay_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                             data += "<h5>GVHD: " + v.instructor + "</h5>";
                            data += "<p class='card-text' data-bind='text:author'></p>";
                            data += "<div class='card-footer'></div>";
                            data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                            data += " </div></div></div>";
                            $('#loadEssay').append(data 
                            $("#formEssay")[0].reset();//reset form
                        } else {
                            if (result.message != null) {
                                $.notify(result.message, errorOptions);
                            }
                            else {
                                $.notify("Thêm thất bại!", errorOptions);
                            }
                        }
                    }
                });

            }
        });
        //Khóa luận
        function simpleTemplating2(result) {
            var data = "";
            $.each(result, function (i, v) {
                data += "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                data += "<div class='card h-100'>";
                data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                data += "<div class='card-body'>";
                data += "<h4 class='card-title'>";//
                data += "<a href='/Details/DetailsThesis?thesis_id=" + v.thesis_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                data += "<h5>giáo viên hd: " + v.instructor + "</h5>";
                data += "<p class='card-text' data-bind='text:author'></p>";
                //data += "<div class='card-footer'></div>";
                data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                data += " </div></div></div>";
            });
            return data;
        }
        // load môn khóaluận
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetSubjectThesis",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                $.each(result, function (i, v) {
                    //load các môn của ebook lên thanh danh mục bên trái
                    $("#loadSubjectOfThesis").append("<li id='thesis_" + v.id + "'><a>" + v.name + "</a></li >");
                    //click môn học load file
                    $("#thesis_" + v.id).click(function (e) {
                        //Ẩn hiện form upload file ở trang chỉ hay uplaod file trong môn học
                        $("#btn_upload2").show();
                        $("#btn_upload1").hide();
                        $("#btn_upload").hide();
                        $("#loadThesis").show();
                        $("#essay").hide();
                        $("#thesis").show();
                        $("#loadThesis").show();
                        $("#ebook").hide();
                        $("#thesis").show();
                        $("#essay").hide();
                        $("#loadEbook").hide();
                        $("#loadEssay").hide();
                        $("#loadEssay").empty();
                        $("#loadEbook").empty();
                        $("#SubjectThesis").empty();
                        $("#SubjectThesis").append("<option value='" + v.id + "'>" + v.name + "</option>");
                       
                        $.ajax({
                            type: "GET",
                            url: "/api/AdminAPI/GetThesis",
                            data: { id: v.id },
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (result) {
                                console.log(v);

                                var tag = $(e.currentTarget).closest('.mainmenu-item');

                                var tagText = $(tag).find('.mainmenu-item-text');
                                $('.breadcrumb-item-2').css("display", "block");
                                $('.breadcrumb-item-3').css("display", "block");
                                $('#breadcrumb-2').text($(tagText).text());
                                $('#breadcrumb-3').text(v.name);

                                $('#pagination-container').pagination({
                                    dataSource: function (done) {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/AdminAPI/GetThesisPaging',
                                            data: { id: v.id },
                                            contentType: "application/json; charset=utf-8",
                                            dataType: "json",
                                            success: function (response) {
                                                done(response);
                                            }
                                        });
                                    },
                                    callback: function (data, pagination) {
                                        var html = simpleTemplating2(data);
                                        $('#loadThesis').html(html);
                                    }
                                })
                            }
                        });
                    });
                });
            }
        });

         $('body').on('click', '#SaveThesis', function () {
            var title = $("#titleT").val();
            var instructor = $("#instructorT").val();
            var student1 = $("#student1T").val();
            var course = $("#courseT").val();
            var files = $("#fileInputT").get(0).files;
            var data = new FormData();

              for (var i = 0; i < files.length; i++) {
                  data.append("fileInput", files[i]);
            }
              //cái này là lấy thông tin trên text box  title là key tiltle.val() là giá trị
            data.append("title", $("#titleT").val());
            data.append("describe", $("#describeT").val());
            data.append("instructor", $("#instructorT").val());
            data.append("student1", $("#student1T").val());
            data.append("student2", $("#student2T").val());
            data.append("userid",@Session["user_id"]);
            data.append("subid", $("#SubjectThesis option:selected").val());
            data.append("course", $("#courseT").val());
            if (title == null || title == "") {
                $("#titleT").focus();
                $.notify("Bạn phải nhập tiêu đề!", warnOptions);
                return;
            }
            if (instructor == null || instructor == "") {
                $("#instructorT").focus();
                $.notify("Bạn phải nhập giáo viên hướng dẫn!", warnOptions);
                return;
            }
            if (student1 == null || student1 == "") {
                $("#student1T").focus();
                $.notify("Bạn phải nhập sinh viên 1!", warnOptions);
                return;
            }
            if (course == null || course == "") {
                $("#courseT").focus();
                $.notify("Bạn phải nhập khóa học!", warnOptions);
                return;
            }
            if (files.length <= 0) {
                $.notify("Bạn phải chọn file!", warnOptions);
                return;
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/api/AdminAPI/UploadFilesThesis",
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    data: data,
                    success: function (result) {
                        if (result.isSuccess) {
                            $.notify("Thêm thành công!", successOptions);
                            var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                            data += "<div class='card h-100'>";
                            data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                            data += "<div class='card-body'>";
                            data += "<h4 class='card-title'>";
                            data += "<a href='/Details/DetailsThesis?thesis_id=" + result.thesis_id + "'" + "data-bind='text:title'>" + result.title + "</a> </h4>";
                            data += "<h5>GVHD: " + result.instructor + "</h5>";
                            data += "<p class='card-text' data-bind='text:author'></p>";
                            data += "<div class='card-footer'></div>";
                            data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                            data += " </div></div></div>";

                            $("#loadThesis").append(data);
                            $("#formThesis")[0].reset();//reset form
                        } else {
                            if (result.message != null) {
                                $.notify(result.message, errorOptions);
                            }
                            else {
                                $.notify("Thêm thất bại!", errorOptions);
                            }
                        }
                    }
                });

            }
        });


 });
    ////SIGNALR
    //$(function () {
    //    $.connection.hub.logging = true;
    //    var chat = $.connection.myHub;
    //    //SignalR thêm môn học vào Ebook
    //    chat.client.postToClient = function (id, name) {
    //        $("#loadSubjectOfEbook").append("<li id='" + id + "'><a>" + name + "</a></li >");
    //    };

    //    //SignalR thêm file
    //    chat.client.postFileEbookToClient = function (id, title, author, describe, filename,
    //        date_upload) {
    //        var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
    //        data += "<div class='card h-100'>";
    //        data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
    //        data += "<div class='card-body'>";
    //        data += "<h4 class='card-title'>";
    //        data += "<a href='#' data-bind='text:title'>" + title + "</a> </h4>";
    //        data += "<h5>tác giả: " + author + "</h5>";
    //        data += "<p class='card-text' data-bind='text:author'></p>";
    //        data += "<div class='card-footer'></div>";
    //        data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
    //        data += " </div></div></div>";

    //        $("#loadEbook").append(data);
    //    };
    //    $.connection.hub.start().done(function () {
    //        //alert("started");
    //    }).fail(function (result) {
    //        alert(result);
    //    });

    //});
 </script>
    <!-- TIỂU LUẬN-->
<script>
       
    @*$(document).ready(function () {
        
        $('#formEssay').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: false,
            rules: {
                titleE: {
                    required: true
                },
                instructorE: {
                    required: true
                },
                courseE: {
                    number: true,
                    minlength: 4,
                    maxlength: 4
                },
                fileInputE: {
                    required: true
                }
            },
            messages: {
                titleE: {
                    required: "Bạn phải nhập tiêu đề"
                },
                instructorE: {
                    required: "Bạn phải nhập giáo viên hướng dẫn"
                },
                courseE: {
                    number: "Năm phải là số",
                    minlength: "Năm không được nhỏ hơn 4 ký tự",
                    maxlength: "Năm không được lớn hơn 4 ký tự"
                },
                fileInputE: {
                    required: "Bạn chọn file",

                }
            },
            submitHandler: function () {
                 //upload file khóa luận
    $("#uploadEssay").click(function () {
            clearFormFile();
            var files = $("#fileInputE").get(0).files;
            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {
                fileData.append("fileInput", files[i]);
            }
        
            fileData.append("title", $("#titleE").val());
            fileData.append("describe", $("#describeE").val());
            fileData.append("instructor", $("#instructorE").val());
            fileData.append("student1", $("#student1E").val());
            fileData.append("student2", $("#student2E").val());
            fileData.append("userid", @Session["user_id"]);
            fileData.append("subid", $("#subjectE option:selected").val());
            fileData.append("year", 'yearE');

            console.log(fileData);
            $.ajax({
                type: "POST",
                url: "/api/AdminAPI/UploadFileEssay",
                dataType: "json",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    if (result.isSuccess) {
                        alert("Upload thành công.");
                    }
                    else {
                        alert("Upload không thành công.");
                    }
                    clearFormFile();
                }
            });

    });

            }
        });
    });

        //SIGNALR
        $(function () {
            $.connection.hub.logging = true;
            var chat = $.connection.myHub;
            //SignalR thêm file
            chat.client.postFileEssayToClient = function (id, title, instructor, executor1, executor1,
                describe, filename, date_upload, user, subject) {
                var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                data += "<div class='card h-100'>";
                data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                data += "<div class='card-body'>";
                data += "<h4 class='card-title'>";
                data += "<a href='/Details/DetailsEssay?essay_id=" + v.essay_id + "'" + "data-bind='text:title'>" + title + "</a> </h4>";
                data += "<h5>GVHD: " + instructor + "</h5>";
                data += "<p class='card-text' data-bind='text:author'></p>";
                data += "<div class='card-footer'></div>";
                data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                data += " </div></div></div>";

                $("#loadEssay").append(data);
            };
            $.connection.hub.start().done(function () {
                //alert("started");
            }).fail(function (result) {
                alert(result);
            });

        });*@
    
    </script>
    <!-- KHÓA LUẬN-->
    <script>
   
        @*$(document).ready(function () {
           
            $('#formThesis').validate({
 
                rules: {
                    titleT: {
                        required: true
                    },
                    instructorT: {
                        required: true
                    },
                    courseT: {
                        number: true,
                        minlength: 4,
                        maxlength: 4
                    },
                    fileInputT: {
                        required: true
                    }
                },
                messages: {
                    titleT: {
                        required: "Bạn phải nhập tiêu đề"
                    },
                    instructorT: {
                        required: "Bạn phải nhập giáo viên hướng dẫn"
                    },
                    courseT: {
                        number: "Năm phải là số",
                        minlength: "Năm không được nhỏ hơn 4 ký tự",
                        maxlength: "Năm không được lớn hơn 4 ký tự"
                    },
                    fileInputT: {
                        required: "Bạn chọn file",
                    }
                },
                submitHandler: function () {
                    //upload file khóa luận
                    $("#uploadThesis").click(function () {
                        clearFormFile();
                        var files = $("#fileInputT").get(0).files;
                        var fileData = new FormData();

                        for (var i = 0; i < files.length; i++) {
                            fileData.append("fileInput", files[i]);
                        }
                        //cái này là lấy thông tin trên text box  title là key tiltle.val() là giá trị

                        fileData.append("title", $("#titleT").val());
                        fileData.append("describe", $("#describeT").val());
                        fileData.append("instructor", $("#instructorT").val());
                        fileData.append("student1", $("#student1T").val());
                        fileData.append("student2", $("#student2T").val());
                        fileData.append("userid", @Session["user_id"]);
                        // fileData.append("subid", $("#subjectT").val());
                        fileData.append("subid", $("#subjectT option:selected").val());
                        fileData.append("course", $("#courseT").val());

                        console.log(fileData);
                        $.ajax({
                            type: "POST",
                            url: "/api/AdminAPI/UploadFilesThesis",
                            dataType: "json",
                            contentType: false, // Not to set any content header
                            processData: false, // Not to process data
                            data: fileData,
                            async: false,
                            success: function (result) {
                                if (result.isSuccess) {
                                    alert("Upload thành công.");
                                }
                                else {
                                    alert("Upload không thành công.");
                                }
                                clearFormFile();
                            }
                        });

                    });
                }
        });

    });

    //SIGNALR
    $(function () {
        $.connection.hub.logging = true;
        var chat = $.connection.myHub;


        //SignalR thêm file
        chat.client.postFileThesisToClient = function (id, thesis_id, title, instructor, executor1, executor1,
            describe, filename, date_upload, user, subject) {
            var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
            data += "<div class='card h-100'>";
            data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
            data += "<div class='card-body'>";
            data += "<h4 class='card-title'>";
            data += "<a href='/Details/DetailsThesis?thesis_id=" + thesis_id + "'" + "data-bind='text:title'>" + title + "</a> </h4>";
            data += "<h5>GVHD: " + instructor + "</h5>";
            data += "<p class='card-text' data-bind='text:author'></p>";
            data += "<div class='card-footer'></div>";
            data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
            data += " </div></div></div>";

            $("#loadThesis").append(data);
        };
        $.connection.hub.start().done(function () {
            //alert("started");
        }).fail(function (result) {
            alert(result);
        });

    });*@
    </script>

    <!--Lấy danh sách các ebook tiểu luận khóa luận mới nhất-->
    <script>
        $.blockUI();
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetEbook1",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                $.each(result, function (i, v) {
                    var data = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                    data += "<div class='card h-100'>";
                    data += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                    data += "<div class='card-body'>";
                    data += "<h4 class='card-title'>";//
                    data += "<a href='/Details/Details?ebook_id=" + v.ebook_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                    data += "<h5>tác giả: " + v.author + "</h5>";
                    data += "<p class='card-text' data-bind='text:author'></p>";
                    //data += "<div class='card-footer'></div>";
                    data += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                    data += " </div></div></div>";
                    $("#loadEbook").append(data);
                });
                $('#admin-content-section').prop("hidden", false);
            }
        });
        $.unblockUI();

    </script>
    <script>
        $.blockUI();
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetEssay1",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                $.each(result, function (i, v) {
                    var data1 = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                    data1 += "<div class='card h-100'>";
                    data1 += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                    data1 += "<div class='card-body'>";
                    data1 += "<h4 class='card-title'>";//
                    data1 += "<a href='/Details/DetailsEssay?essay_id=" + v.essay_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                    data1 += "<h5>giáo viên hd: " + v.instructor + "</h5>";
                    data1 += "<p class='card-text' data-bind='text:author'></p>";
                    //data += "<div class='card-footer'></div>";
                    data1 += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                    data1 += " </div></div></div>";

                    $("#loadEssay").append(data1);

                });
            }
        });
        $.unblockUI();

    </script>
    <script>
        $.blockUI();
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetThesis1",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

                $.each(result, function (i, v) {
                    var data1 = "<div class='col-lg-4 col-md-6 mb-4' data-bind='attr: { id: id }'>";
                    data1 += "<div class='card h-100'>";
                    data1 += "<a href='#'><img class='card-img-top' src='/Content/img/PDF (2).png' alt=''></a>";
                    data1 += "<div class='card-body'>";
                    data1 += "<h4 class='card-title'>";//
                    data1 += "<a href='/Details/DetailsThesis?thesis_id=" + v.thesis_id + "'" + "data-bind='text:title'>" + v.title + "</a> </h4>";
                    data1 += "<h5>giáo viên hd: " + v.instructor + "</h5>";
                    data1 += "<p class='card-text' data-bind='text:author'></p>";
                    //data += "<div class='card-footer'></div>";
                    data1 += "<small class='text-muted'>&#9733; &#9733; &#9733; &#9733; &#9733;</small>";
                    data1 += " </div></div></div>";
                    $("#loadThesis").append(data1);
                });
            }
        });
        $.unblockUI();

    </script>


