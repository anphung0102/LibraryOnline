
@{
    var user = Session["username"];
    if (Session["username"] == null || Session["user_id"] == null)
    {
        Response.Redirect("~/Login/Index");
    }
    if (Session["role_id"].ToString() == "1")
    {
        Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    }
    if (Session["role_id"].ToString() == "2")
    {
        Layout = "~/Views/Shared/_LayoutLecturer.cshtml";
    }
    if (Session["role_id"].ToString() == "3")
    {
        Layout = "~/Views/Shared/_LayoutStudent.cshtml";
    }

}

<div class="container" id="admin-container">
    <span id="counter" class="timer" hidden></span> <br />
    <div id="loadfile" style="text-align:center; margin-top:5px"></div>
</div>
<script>
        $(window).bind('beforeunload', function (e) {
            //do something
            //wnd.close();
             var subid;
            $.ajax({
             type: "GET",
                url: "/api/AdminAPI/GetSubByBookID?bookid=" + '@ViewBag.ID',
             contentType: "application/json; charset=utf-8",
             dataType: "json",
             async: false,
             success: function (result) {
                subid = result;
             }
            });
             var bookId = '@ViewBag.Id';
                var model = {};
                model.UserId = $("#userid").html();
                model.BookId = bookId;
                model.Time = $("#counter").html();
                model.SubId = subid;
                $.ajax({
                    type: "POST",
                    url: "/api/TimeAPI/SaveTime",
                    data: JSON.stringify(model),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (v) {
                    }
                });
        });
</script>
<script>

    $(document).ready(function () {
        $('.timer').countimer();
        @*window.addEventListener('beforeunload', (event) => {
            debugger
           // event.preventDefault();
            $('.timer').stop();
            var bookId = '@ViewBag.Id';
                var model = {};
                model.UserId = $("#userid").html();
                model.BookId = bookId;
                model.Time = $("#counter").html()
                $.ajax({
                    type: "POST",
                    url: "/api/TimeAPI/SaveTime",
                    data: JSON.stringify(model),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (v) {
                        alert("aaaaaa");
                    }
                });
        });*@
        $("footer").hide();

    });
 $(document).ready(function () {
      var val = '@ViewBag.Id';
        $.ajax({
            type: "GET",
            url: "/api/AdminAPI/GetFileById",
            data: { ebook_id: val},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                console.log(result[0]);
               //var data = "<div class='col-lg-12 col-md-6 mb-4' >";
               // //data += "<h2>Sách: " + v.title + "</h2>";
               // data += "<embed src='/Content/Upload/" + v.filename + "' type='application/pdf' height='700px' width='70%' class='responsive'>";

               // data += "</div > ";
               // $("#loadfile").append(data);
                //data += "<h2>Sách: " + v.title + "</h2>";
                var data = "<embed src='/Content/Upload/" + result[0].filename + "' type='application/pdf' height='564px' width='100%' class='responsive'>";
                
                $("#loadfile").append(data);
            }
     });

    });
</script>