
@{
    var user = Session["username"];
    if (Session["username"] == null || Session["user_id"] == null)
    {
        Response.Redirect("~/Login/Index");
    }
    if (Session["role_id"].ToString() == "1")
    {
        Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    }
    if (Session["role_id"].ToString() == "2")
    {
        Layout = "~/Views/Shared/_LayoutLecturer.cshtml";
    }
    if (Session["role_id"].ToString() == "3")
    {
        Layout = "~/Views/Shared/_LayoutStudent.cshtml";
    }

}
@*<link href="~/Scripts/rateit.css" rel="stylesheet" type="text/css">
    <script src="~/Scripts/jquery.rateit.js"></script>
    <script src="~/Scripts/jquery.rateit.min.js"></script>*@
@*<link href="~/Scripts/jquery-3.3.1.slim.min.map" rel="stylesheet" type="text/css">*@
<!-- Page Content -->
<style>
    .class1{
        margin-left:10px;
        margin-right:4px;
    }
</style>
<div class="container">

    <div class="row">
        <div class="col-lg-12">

            <div id="carouselExampleIndicators" class="carousel slide my-4" data-ride="carousel" style="width:1140px;">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner" role="listbox">
                    <div class="carousel-item active">
                        <img class="d-block img-fluid" src="http://placehold.it/1140x350" alt="First slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block img-fluid" src="http://placehold.it/900x350" alt="Second slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block img-fluid" src="http://placehold.it/900x350" alt="Third slide">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            <!--          tạo các tab liên quan-->
            <div id="navigation">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item"><a href="#">Ebooks</a></li>
                    <li class="breadcrumb-item active">Product</li>
                </ul>
            </div><!-- navigation -->
            @*<h1 class="khoangcachduoi">Products</h1>*@
            <div class="row" id="detail" style="float:left;width:60%">
            </div>
            <div class="row" style="margin-top:20px;">
                <div class='col-lg-12 col-md-6 mb-4'>
                    <div class='border'>
                        <div class="row" id='info_details' style="height:300px">
                            <div class='col-lg-6'>
                                <div>Đánh giá:</div>
                                <div class="rateit" id="rateit_star1" data-rateit-step="1" data-productid="123"></div>
                                <button id="btnRate">Gửi</button>
                                <div>Thống kê:</div>
                                <div class="row">
                                    <p class="class1">Rất hay</p><div class="rateit" data-rateit-value="5" data-rateit-readonly="true"></div>
                                    <a href="">Số người đánh giá</a>
                                </div>
                                <div class="row">
                                    <p class="class1">Hay</p><div class="rateit" data-rateit-value="4" data-rateit-readonly="true"></div>
                                </div>
                                <div class="row">
                                    <p class="class1">Vừa phải</p><div class="rateit" data-rateit-value="3" data-rateit-readonly="true"></div>

                                </div>
                                <div class="row">
                                    <p class="class1">Tệ</p><div class="rateit" data-rateit-value="2" data-rateit-readonly="true"></div>

                                </div>
                                <div class="row">
                                    <p class="class1">Quá tệ</p><div class="rateit" data-rateit-value="1" data-rateit-readonly="true"></div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
           
        </div>
        <!-- /.col-lg-9 -->

    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
<!-- Footer -->

<script>
    $(document).ready(function () {
        $("#btnRate").click(function () {
            var data = {};
            data.rate = $('#rateit_star1').rateit('value');
            data.bookid = '@ViewBag.ID';
            data.username = $("#fullname").html();
            data.userid = $("#userid").html();
            console.log("bookid",data);
            $.ajax({
                type: "POST",
                url: "/api/AdminAPI/SaveRate",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result.isSuccess) {
                        alert("Bạn đã đánh giá sách!");
                    }
                }
            });
        });
    });
</script>
<script>
    $("#upload").click(function () {

        var ebook = {};
        ebook.title = $("#title").val(); //get từ textbox
        ebook.describe = $("#describe").val(); //get từ text boxt
        ebook.year = $("#year").val(); //get từ textbox
        ebook.user_id = $("#user_id").val(); //get từ text boxt
        ebook.filename = $("#filename").val(); //get từ text boxt
        $.ajax({
            type: "POST",
            url: "/api/FileAPI/UploadEbook",
            data: JSON.stringify(ebook),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {

            }
        });
    });
     // load data
    $(document).ready(function () {
         var val = '@ViewBag.ID';
        $.ajax({
            type: "GET",
            url: "http://localhost:52385/api/AdminAPI/GetFileById",
            data: { ebook_id: val },
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (v) {
                console.log(v);

               var data = "<div class='col-lg-12 col-md-6 mb-4' >";
                data += "<div class='border'>";
                data += "<div class='row' id='info_details'>";
                data += "<div class='col-lg-6'>";
                data += "<h2>" + v.title + "</h2>";
                data += "<p>Tác giả: " + v.author + "</p>";
                data += "<p>Năm xuất bản: " + v.year + "</p>";
                data += "<div id='rate' class='rateit'></div>";
                data += "<div id='button_details'>";
                data += "<p id='pdf-link' hidden='hidden'>/Content/Upload/" + v.filename+"</p>";
                data += "<button style='width: 100px;'><a href='/ReadFileDetails/Index?ebook_id=" + v.ebook_id + "'" + "data-bind='text:title'>đọc</a></button>";
          
                data += `<a href="/Content/Upload/${v.filename}" >
                    <input type="button" value="Download" /></a >`

                data += " </div>";
                data += "<div><h2>Mô tả:</h2>";
                data += "<p>" + v.describe + "</p>";
                data += "</div ></div ></div ></div > ";
                $("#detail").append(data);

            }
        });
    });


    function openPDF(link) {
        //alert(link);
        if (link) {
            window.open(link);
        }
    }

    $("body").on('click','#read',function () {
        openPDF($('#pdf-link').text());
    });

</script>